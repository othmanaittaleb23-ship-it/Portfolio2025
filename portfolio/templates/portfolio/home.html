{% extends 'portfolio/base.html' %}
{% load static %}
{% load media_extras %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section d-flex align-items-center min-vh-100">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="hero-content">
                    <h1 class="display-4 fw-bold text-white mb-4">
                        Salut, je suis <span class="text-accent">{{ about.name|default:"Othman" }}</span>
                    </h1>
                    <h2 class="h3 mb-4" style="color: var(--text-secondary);">{{ about.title|default:"Développeur Full Stack" }}</h2>
                    <p class="lead mb-4" style="color: var(--text-secondary);">
                        {{ about.description|default:"Passionné par le développement web et mobile, je crée des solutions innovantes et performantes." }}
                    </p>
                    <div class="hero-buttons">
                        <a href="#projects" class="btn btn-primary btn-lg me-3">
                            <i class="fas fa-rocket me-2 icon-lg"></i>Projets
                        </a>
                        <a href="{% url 'contact' %}" class="btn btn-ghost btn-lg">
                            <i class="fas fa-paper-plane me-2 icon-lg"></i>Me Contacter
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="hero-image text-center">
                    {% if about.profile_image %}
                    <img src="{{ about.profile_image|image_src }}" alt="{{ about.name }}" class="img-fluid rounded-circle shadow-lg" style="max-width: 420px; border:6px solid rgba(255,255,255,0.03); opacity: 1 !important;">
                    {% else %}
                    <div class="placeholder-image d-flex align-items-center justify-content-center bg-accent rounded-circle mx-auto" style="width: 420px; height: 420px;">
                        <i class="fas fa-user icon-xl text-white"></i>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="scroll-indicator">
        <a href="#about" class="scroll-down">
            <i class="fas fa-chevron-down"></i>
        </a>
    </div>
</section>

<!-- Stats Section -->
<section class="stats-section py-5">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-3 col-6 mb-4">
                <div class="stat-card">
                    <div class="stat-icon mb-3">
                        <i class="fas fa-code"></i>
                    </div>
                    <h3 class="stat-number" data-target="{{ stats.projects_count }}">0</h3>
                    <p class="stat-label">Projets Réalisés</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="stat-card">
                    <div class="stat-icon mb-3">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="stat-number" data-target="{{ stats.years_experience }}">0</h3>
                    <p class="stat-label">Années d'Expérience</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="stat-card">
                    <div class="stat-icon mb-3">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <h3 class="stat-number" data-target="{{ stats.technologies_count }}">0</h3>
                    <p class="stat-label">Technologies</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="stat-card">
                    <div class="stat-icon mb-3">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h3 class="stat-number" data-target="{{ stats.satisfaction_rate }}">0</h3>
                    <p class="stat-label">% Satisfaction</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Disponibilité Stage Section -->
<section class="stage-info-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="stage-info-card">
                    <div class="row align-items-center">
                        <div class="col-lg-3 text-center mb-4 mb-lg-0">
                            <div class="stage-icon">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <h4 class="mt-3 mb-0">Stage PFE</h4>
                            <p class="text-muted small">Disponible</p>
                        </div>
                        <div class="col-lg-9">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="info-item">
                                        <i class="fas fa-calendar-alt text-primary me-2"></i>
                                        <div>
                                            <strong>Date de début</strong>
                                            <p class="mb-0 text-muted">Février 2025</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="info-item">
                                        <i class="fas fa-clock text-primary me-2"></i>
                                        <div>
                                            <strong>Durée</strong>
                                            <p class="mb-0 text-muted">4-6 mois (flexible)</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="info-item">
                                        <i class="fas fa-graduation-cap text-primary me-2"></i>
                                        <div>
                                            <strong>Formation</strong>
                                            <p class="mb-0 text-muted">Ingénieur en Informatique</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="info-item">
                                        <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                        <div>
                                            <strong>Localisation</strong>
                                            <p class="mb-0 text-muted">Maroc ou Remote</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <a href="{% url 'contact' %}" class="btn btn-primary">
                                    <i class="fas fa-paper-plane me-2"></i>Discuter de mon stage
                                </a>
                                {% if about.cv %}
                                <a href="{{ about.cv.url }}" class="btn btn-outline-primary ms-2" download>
                                    <i class="fas fa-download me-2"></i>Télécharger mon CV
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- About Section -->
<section id="about" class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h2 class="section-title mb-5">À propos de moi</h2>
                <p class="lead">
                    {{ about.description|default:"Développeur passionné avec une expertise en développement web full-stack. J'aime créer des solutions innovantes et performantes qui améliorent l'expérience utilisateur." }}
                </p>
                <!-- Badge Disponibilité -->
                <div class="availability-badge mt-4">
                    <span class="status-dot"></span>
                    <span class="status-text">Disponible pour de nouvelles opportunités</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Skills Section -->
<section id="skills" class="py-5 bg-light">
    <div class="container">
        <h2 class="section-title text-center mb-5">Compétences</h2>
        <div class="text-center mb-4">
            <small class="text-muted">Cliquez sur une catégorie pour afficher les compétences correspondantes</small>
        </div>
        <div id="skill-categories" class="mb-3 text-center">
            {% for cat in grouped_skills_keys %}
            <button class="btn btn-outline-primary me-2 skill-cat-btn" data-cat="{{ cat }}">{{ cat }}</button>
            {% endfor %}
        </div>
        <div id="skill-list-area" class=""></div>

        <script id="grouped-skills-json" type="application/json">{{ grouped_skills_json|safe }}</script>
        <script>
            // Inline fallback: attach click handlers to category buttons and render skills
            (function(){
                try {
                    const groupedEl = document.getElementById('grouped-skills-json');
                    const grouped = groupedEl ? JSON.parse(groupedEl.textContent || '{}') : {};
                    const container = document.getElementById('skill-categories');
                    const skillsArea = document.getElementById('skill-list-area');
                    if (!container || !skillsArea) return;

                    const buttons = container.querySelectorAll('.skill-cat-btn');
                    buttons.forEach(btn => {
                        btn.addEventListener('click', function(){
                            const cat = this.dataset.cat;
                            console.log('inline handler click:', cat);
                            // set active class
                            buttons.forEach(b=>b.classList.remove('active'));
                            this.classList.add('active');
                            const skills = grouped[cat] || [];
                            if (!skills.length) {
                                skillsArea.innerHTML = '<p class="text-muted">Aucune compétence dans cette catégorie.</p>';
                                return;
                            }
                            let html = '<div class="row">';
                            skills.forEach(s => {
                                html += `<div class="col-md-6 col-lg-4 mb-3">` +
                                    `<div class="skill-card p-3 rounded shadow-sm h-100" style="color: var(--white);">` +
                                    `<div class="d-flex justify-content-between align-items-center mb-2">` +
                                    `<span style="color: var(--white);"><i class="${s.icon} me-2"></i>${s.name}</span>` +
                                    `<span class="text-muted">${s.level}%</span>` +
                                    `</div>` +
                                    `<div class="progress"><div class="progress-bar bg-primary" role="progressbar" style="width: ${s.level}%"></div></div>` +
                                    `</div></div>`;
                            });
                            html += '</div>';
                            skillsArea.innerHTML = html;
                        });
                    });
                } catch (e) {
                    console.error('Fallback skills init error', e);
                }
            })();
        </script>
    </div>
</section>

<!-- Projects Section -->
<section id="projects" class="py-5">
    <div class="container">
        <h2 class="section-title text-center mb-5">Mes Projets</h2>
        
        <!-- Project Filters -->
        <div class="project-filters text-center mb-4">
            <button class="filter-btn active" data-filter="all">
                <i class="fas fa-th me-2"></i>Tous
            </button>
            <button class="filter-btn" data-filter="web">
                <i class="fas fa-globe me-2"></i>Web
            </button>
            <button class="filter-btn" data-filter="mobile">
                <i class="fas fa-mobile-alt me-2"></i>Mobile
            </button>
            <button class="filter-btn" data-filter="fullstack">
                <i class="fas fa-layer-group me-2"></i>Full Stack
            </button>
            <button class="filter-btn" data-filter="other">
                <i class="fas fa-code me-2"></i>Autres
            </button>
        </div>
        
        <div class="row" id="projects-container">
            {% for project in projects %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="project-card card h-100 shadow-sm">
                    {% if project.image %}
                    <img src="{{ project.image|image_src }}" class="card-img-top" alt="{{ project.title }}" style="height: 200px; object-fit: cover;">
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ project.title }}</h5>
                        <p class="card-text flex-grow-1">{{ project.short_description|default:project.description|truncatewords:20 }}</p>
                        <div class="technologies mb-3">
                            {% for tech in project.get_technologies_list %}
                            <span class="badge bg-primary me-1">{{ tech }}</span>
                            {% endfor %}
                        </div>
                        <div class="project-links">
                            {% if project.demo_video_file or project.demo_video_url %}
                            <button class="btn btn-video btn-sm me-2" data-bs-toggle="modal" data-bs-target="#videoModal{{ project.id }}">
                                <i class="fas fa-play-circle me-1"></i>Vidéo Démo
                            </button>
                            {% endif %}
                            {% if project.github_url %}
                            <a href="{{ project.github_url }}" class="btn btn-outline-primary btn-sm me-2" target="_blank">
                                <i class="fab fa-github me-1"></i>Code
                            </a>
                            {% endif %}
                            {% if project.github_url_2 %}
                            <a href="{{ project.github_url_2 }}" class="btn btn-outline-secondary btn-sm me-2" target="_blank">
                                <i class="fab fa-github me-1"></i>Code (Backend)
                            </a>
                            {% endif %}
                            {% if project.live_url %}
                            <a href="{{ project.live_url }}" class="btn btn-primary btn-sm" target="_blank">
                                <i class="fas fa-external-link-alt me-1"></i>Démo
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-4">
            <a href="{% url 'about' %}#projects-section" class="btn btn-outline-primary btn-lg">
                Voir mon parcours complet <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</section>

<!-- Video Modals -->
{% for project in projects %}
{% if project.demo_video_file or project.demo_video_url %}
<div class="modal fade" id="videoModal{{ project.id }}" tabindex="-1" aria-labelledby="videoModalLabel{{ project.id }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content video-modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="videoModalLabel{{ project.id }}">
                    <i class="fas fa-play-circle me-2"></i>{{ project.title }} - Démonstration
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <div class="video-container">
                    {% with video_url=project.get_demo_video %}
                    {% if 'youtube.com' in video_url or 'youtu.be' in video_url or 'vimeo.com' in video_url %}
                    <iframe src="{{ project.get_video_embed_url }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    {% else %}
                    <video controls>
                        <source src="{{ video_url }}" type="video/mp4">
                        Votre navigateur ne supporte pas la lecture de vidéos.
                    </video>
                    {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}

<!-- Work Process Section -->
<section class="work-process-section py-5">
    <div class="container">
        <h2 class="section-title text-center mb-5">Mon Processus de Travail</h2>
        <div class="row">
            <div class="col-md-3 col-6 mb-4">
                <div class="process-step text-center">
                    <div class="process-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h5 class="mt-3">1. Analyse</h5>
                    <p class="text-muted small">Comprendre vos besoins et objectifs</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="process-step text-center">
                    <div class="process-icon">
                        <i class="fas fa-pencil-ruler"></i>
                    </div>
                    <h5 class="mt-3">2. Design</h5>
                    <p class="text-muted small">Créer une solution adaptée</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="process-step text-center">
                    <div class="process-icon">
                        <i class="fas fa-code"></i>
                    </div>
                    <h5 class="mt-3">3. Développement</h5>
                    <p class="text-muted small">Coder avec les meilleures pratiques</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="process-step text-center">
                    <div class="process-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h5 class="mt-3">4. Livraison</h5>
                    <p class="text-muted small">Déployer et assurer le suivi</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact CTA Section -->
<section class="py-5">
    <div class="container">
        <div class="row align-items-center cta-section">
            <div class="col-md-8">
                <h2 class="section-title mb-2">Prêt à collaborer ?</h2>
                <p class="lead text-muted">Je suis disponible pour des projets, missions freelance ou collaborations. Parlons-en.</p>
            </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <a href="{% url 'contact' %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-paper-plane me-2"></i>Contactez-moi
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

