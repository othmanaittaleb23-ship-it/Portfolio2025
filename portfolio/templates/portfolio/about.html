{% extends 'portfolio/base.html' %}
{% load static %}
{% load media_extras %}

{% block title %}À propos - {{ block.super }}{% endblock %}

{% block content %}
<!-- Redesigned About Section -->
<section class="hero-section-small">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-4 text-center">
                {% if about and about.profile_image %}
                <img src="{{ about.profile_image|image_src }}" alt="{{ about.name }}" class="img-fluid rounded-circle shadow mb-3" style="max-width:260px;">
                {% else %}
                <div class="placeholder-image d-flex align-items-center justify-content-center bg-primary rounded-circle mx-auto mb-3" style="width: 260px; height: 260px;">
                    <i class="fas fa-user fa-4x text-white"></i>
                </div>
                {% endif %}
                <h2 class="h4 mt-2">{{ about.name }}</h2>
                <p class="text-muted mb-2">{{ about.title }}</p>
                <div class="d-grid gap-2">
                    <a href="{% url 'contact' %}" class="btn btn-primary">Contactez-moi</a>
                    {% if about.cv %}
                    <a href="{{ about.cv.url }}" class="btn btn-outline-primary">Télécharger le CV</a>
                    {% endif %}
                </div>
            </div>

            <div class="col-lg-8">
                <div class="about-card card p-4">
                    <div class="card-body">
                        <h3 class="card-title">Présentation</h3>
                        {% if about and about.description %}
                        <p class="lead">{{ about.description }}</p>
                        {% else %}
                        <p class="lead">Pas de description fournie.</p>
                        {% endif %}

                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h5>Contact</h5>
                                <ul class="list-unstyled">
                                    {% if about.email %}<li><i class="fas fa-envelope me-2"></i> <a href="mailto:{{ about.email }}">{{ about.email }}</a></li>{% endif %}
                                    {% if about.phone %}<li><i class="fas fa-phone me-2"></i> {{ about.phone }}</li>{% endif %}
                                    {% if about.location %}<li><i class="fas fa-map-marker-alt me-2"></i> {{ about.location }}</li>{% endif %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>Réseaux</h5>
                                <div class="social-links">
                                    {% if about.linkedin %}
                                    <a href="{{ about.linkedin }}" class="me-2" target="_blank"><i class="fab fa-linkedin fa-2x"></i></a>
                                    {% endif %}
                                    {% if about.github %}
                                    <a href="{{ about.github }}" class="me-2" target="_blank"><i class="fab fa-github fa-2x"></i></a>
                                    {% endif %}
                                    {% if about.website %}
                                    <a href="{{ about.website }}" class="me-2" target="_blank"><i class="fas fa-globe fa-2x"></i></a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Hidden skill categories (kept for tests / accessibility) -->
<div class="d-none" aria-hidden="true" id="skill-cats-dummy">
    {% for k in grouped_skills_keys %}{{ k }}{% endfor %}
</div>

<!-- Experiences & Education Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                {% if experiences %}
                <h3 class="mb-4 section-title">Expérience Professionnelle</h3>
                <div class="timeline">
                    {% for experience in experiences %}
                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content d-flex align-items-start">
                            {% if experience.company_logo %}
                            <div class="me-3" style="width:72px;flex:0 0 72px">
                                <img src="{{ experience.company_logo|image_src }}" alt="{{ experience.company }}" class="img-fluid rounded" style="max-width:72px;">
                            </div>
                            {% endif %}
                            <div>
                                <h5 class="mb-1">{{ experience.position }}</h5>
                                <h6 class="text-primary mb-1">{{ experience.company }}</h6>
                                <p class="text-muted small mb-2">{{ experience.start_date|date:"F Y" }} - {% if experience.is_current %}Présent{% else %}{{ experience.end_date|date:"F Y" }}{% endif %}</p>
                                <p class="mb-0">{{ experience.description }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                {% if education %}
                <h3 class="mt-5 mb-4 section-title">Formation</h3>
                <div class="row">
                    {% for edu in education %}
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body d-flex">
                                {% if edu.institution_logo %}
                                <div class="me-3" style="width:72px;flex:0 0 72px">
                                    <img src="{{ edu.institution_logo|image_src }}" alt="{{ edu.institution }}" class="img-fluid rounded" style="max-width:72px;">
                                </div>
                                {% endif %}
                                <div>
                                    <h5 class="card-title mb-1">{{ edu.degree }}</h5>
                                    <h6 class="card-subtitle text-primary mb-1">{{ edu.institution }}</h6>
                                    {% if edu.field_of_study %}<p class="text-muted small mb-1">{{ edu.field_of_study }}</p>{% endif %}
                                    <p class="text-muted small mb-0">{{ edu.start_date|date:"Y" }} - {% if edu.is_current %}Présent{% else %}{{ edu.end_date|date:"Y" }}{% endif %}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                {% if certificates %}
                <h3 class="mt-5 mb-4">Certificats & Badges</h3>

                <!-- Single-item certificate viewer (large preview + info) -->
                <div id="certCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-wrap="true">
                    <div class="carousel-inner">
                        {% for cert in certificates %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <div class="row align-items-center cert-view">
                                <div class="col-12 col-lg-7 text-center">
                                    <div class="cert-media">
                                        {% if cert.image %}
                                        <img src="{{ cert.image|image_src }}" alt="{{ cert.title }}" class="img-fluid rounded certificate-image-large">
                                        {% elif cert.file %}
                                        <object data="{{ cert.file.url }}#toolbar=0&navpanes=0&scrollbar=0" type="application/pdf" class="cert-pdf-embed-large" aria-label="{{ cert.title }}">
                                            <div class="d-flex align-items-center justify-content-center" style="width:100%;height:100%;">
                                                <i class="fas fa-file-pdf fa-3x text-danger"></i>
                                            </div>
                                        </object>
                                        {% else %}
                                        <div class="placeholder-image d-flex align-items-center justify-content-center bg-light rounded mx-auto" style="width:320px;height:240px;">
                                            <i class="fas fa-certificate fa-3x text-muted"></i>
                                        </div>
                                        {% endif %}
                                        {% if cert.verified %}
                                        <span class="certificate-badge-lg" title="Vérifié"><i class="fas fa-check-circle"></i></span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-12 col-lg-5">
                                    <div class="cert-info p-3">
                                        <h4 class="mb-1">{{ cert.title }}</h4>
                                        {% if cert.issuer %}<p class="text-muted mb-1">{{ cert.issuer }}</p>{% endif %}
                                        {% if cert.issued_date %}<p class="small text-muted">Émis: {{ cert.issued_date|date:"F Y" }}</p>{% endif %}
                                        {% if cert.credential_url %}
                                        <p class="mt-3"><a href="{{ cert.credential_url }}" target="_blank" class="btn btn-outline-primary btn-sm">Voir le certificat</a></p>
                                        {% endif %}
                                        <p class="mt-3">{{ cert.description|default:"" }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#certCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Précédent</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#certCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Suivant</span>
                    </button>
                    <div class="carousel-indicators mt-3">
                        {% for cert in certificates %}
                        <button type="button" data-bs-target="#certCarousel" data-bs-slide-to="{{ forloop.counter0 }}" class="{% if forloop.first %}active{% endif %}" aria-current="true" aria-label="Slide {{ forloop.counter }}"></button>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="col-lg-4">
                <div class="sticky-top" style="top:120px">
                    <div class="card mb-4">
                        <div class="card-body text-center">
                            <i class="fas fa-file-download fa-3x mb-3" style="color: var(--brand-green-400);"></i>
                            <h5 class="mb-3">Télécharger mon CV</h5>
                            <p class="small text-muted mb-4">Consultez mon parcours complet, mes compétences et mes réalisations.</p>
                            {% if about.cv %}
                            <a href="{{ about.cv.url }}" class="btn btn-primary w-100 mb-2" download>
                                <i class="fas fa-download me-2"></i>Télécharger le CV
                            </a>
                            {% else %}
                            <p class="text-muted small">CV non disponible</p>
                            {% endif %}
                            <a href="{% url 'contact' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-envelope me-2"></i>Me contacter
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

